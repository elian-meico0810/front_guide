<div class="bg-white rounded-xl shadow mt-4 relative">
  <table class="min-w-full border-collapse text-left">
    <thead class="bg-gray-50 text-gray-600 uppercase text-xs">
      <tr>
        <!-- Checkbox principal (seleccionar todo) -->
        <th class="px-4 py-3">
          <input type="checkbox" class="accent-blue-600 cursor-pointer" [(ngModel)]="selectAll"
            (change)="toggleAllSelections()" />
        </th>

        <!-- Encabezados dinámicos con filtro tipo dropdown -->
        <th *ngFor="let col of columns" class="px-4 py-3 font-semibold relative">
          <div class="flex items-center gap-2">
            <span class="whitespace-normal break-words">{{ col.label }}</span>
            <button *ngIf="col?.filter"
              class="w-6 h-6 flex items-center justify-center rounded-full hover:bg-gray-200 transition"
              (click)="onFilter(col)" title="Filtrar {{ col.label }}">
              <i class="fa-solid fa-filter text-gray-400 text-xs"></i>
            </button>
          </div>

          <!-- Dropdown de filtro -->
          <div *ngIf="col.filter && activeFilter === col.key"
            class="absolute z-10 bg-white border border-gray-200 rounded-md shadow-md mt-2 w-60 max-w-xs">
            <div class="flex justify-between items-center px-3 py-2 border-b">
              <span class="text-sm font-semibold text-gray-700">Filtrar</span>
              <button (click)="closeFilter()" class="text-gray-400 hover:text-gray-600">
                <i class="fa-solid fa-xmark text-sm"></i>
              </button>
            </div>

            <!-- Lista de valores -->
            <ul class="max-h-64 overflow-auto">
              <li *ngFor="let value of getUniqueValues(col.key)" (click)="selectFilter(col.key, value)" [ngClass]="{
                  'bg-blue-100 text-blue-800 font-semibold': filters[col.key] === value,
                  'hover:bg-blue-50 text-gray-700': filters[col.key] !== value
                }"
                class="px-3 py-2 text-sm cursor-pointer break-words whitespace-normal leading-snug transition-colors duration-150 rounded-md">
                {{ value }}
              </li>
            </ul>


            <div class="border-t px-3 py-2 text-center">
              <button (click)="clearFilter(col.key)" class="text-xs text-blue-600 hover:underline font-medium">
                Limpiar filtro
              </button>
            </div>
          </div>
        </th>


        <th *ngIf="showActions" class="px-4 py-3 font-semibold text-center">Acciones</th>
      </tr>
    </thead>

    <tbody>
      <tr *ngFor="let item of filteredData" class="border-t hover:bg-gray-50 transition">
        <!-- Checkbox individual -->
        <td class="px-4 py-3">
          <input type="checkbox" class="accent-blue-600 cursor-pointer" [(ngModel)]="item.selected"
            (change)="updateSelection(item)" />
        </td>

        <!-- Datos dinámicos -->
        <td *ngFor="let col of columns" class="px-4 py-3 text-sm text-gray-600 font-medium">
          <span *ngIf="col.type === 'date'">
            {{ formatDate(item[col.key]) }}
          </span>
          <span *ngIf="col.type === 'currency'">
            {{ formatCurrency(item[col.key]) }}
          </span>
          <span *ngIf="!col.type">
            {{ item[col.key] }}
          </span>
          <span *ngIf="col.type === 'soporte'" class="flex items-center gap-2">
            <i class="fa-regular fa-file text-gray-400"></i>
            <a href="javascript:void(0);" (click)="openFile.emit(item)" class="text-black font-semibold truncate">
              {{ item[col.key] }}
            </a>

            <span *ngIf="!item[col.key]" class="text-gray-400 italic">
              Sin archivo
            </span>
          </span>




        </td>

        <!-- Botones de acción individuales -->
        <td *ngIf="showActions" class="px-4 py-3 text-center flex justify-center gap-3">
          <button class="text-gray-500 hover:text-red-600 transition" (click)="onDelete(item)">
            <i class="fa-solid fa-trash text-lg"></i>
          </button>
        </td>
      </tr>
    </tbody>
  </table>
</div>