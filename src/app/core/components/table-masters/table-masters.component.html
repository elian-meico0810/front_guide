<div class="bg-white rounded-xl shadow mt-4 relative">
  <table class="min-w-full border-collapse text-center">
    <thead class="bg-gray-50 text-gray-600 uppercase text-xs">
      <tr>
        <th *ngFor="let col of columns" class="px-4 py-3 font-semibold relative">
          <div class="flex items-center justify-center gap-2">
            <span>{{ col.label }}</span>

            <!-- BotÃ³n de filtro -->
            <button *ngIf="col.filter"
              class="w-6 h-6 flex items-center justify-center rounded-full hover:bg-gray-200 transition"
              (click)="onFilter(col)" title="Filtrar {{ col.label }}">
              <i class="fa-solid fa-filter text-gray-400 text-xs"></i>
            </button>
          </div>

          <!-- Dropdown de filtro -->
          <div *ngIf="col.filter && activeFilter === col.key"
            class="absolute z-10 bg-white border border-gray-200 rounded-md shadow-md mt-2 w-48">
            <div class="flex justify-between items-center px-3 py-2 border-b">
              <span class="text-xs font-semibold text-gray-600">Filtrar</span>
              <button (click)="closeFilter()" class="text-gray-400 hover:text-gray-600">
                <i class="fa-solid fa-xmark text-sm"></i>
              </button>
            </div>

            <ul class="max-h-48 overflow-auto">
              <li *ngFor="let value of getUniqueValues(col.key)" (click)="selectFilter(col.key, value)" [ngClass]="{
                  'bg-blue-100 text-blue-800 font-semibold': filters[col.key] === value,
                  'hover:bg-blue-50 text-gray-700': filters[col.key] !== value
                }"
                class="px-3 py-2 text-sm cursor-pointer break-words whitespace-normal leading-snug transition-colors duration-150 rounded-md">
                {{ value }}
              </li>
            </ul>

            <div class="border-t px-3 py-2 text-center">
              <button (click)="clearFilter(col.key)" class="text-xs text-blue-600 hover:underline font-medium">
                Limpiar filtro
              </button>
            </div>
          </div>
        </th>

        <th *ngIf="showActions" class="px-4 py-3 font-semibold text-center">Acciones</th>
      </tr>
    </thead>

    <tbody>
      <tr *ngFor="let item of filteredData" class="border-t hover:bg-gray-50 transition">
        <td *ngFor="let col of columns"
          class="px-4 py-3 text-sm text-gray-600 font-medium break-words whitespace-normal leading-snug align-top">
          <ng-container [ngSwitch]="col.type">
            <span *ngSwitchCase="'date'">{{ formatDate(item[col.key]) }}</span>
            <span *ngSwitchCase="'currency'">{{ formatCurrency(item[col.key]) }}</span>
            <span *ngSwitchCase="'soporte'" class="flex items-center gap-2">
              <i class="fa-regular fa-file text-gray-400"></i>
              <a href="javascript:void(0);" (click)="openFile.emit(item)" class="text-black font-semibold truncate">
                {{ item[col.key] || 'Sin archivo' }}
              </a>
            </span>
            <span *ngSwitchCase="'estado'" class="flex justify-center">
              <span
                class="inline-flex items-center justify-center min-w-[90px] h-[22px] text-center transition-all duration-200 font-bold px-2 py-[3px] text-xs shadow-sm rounded-full border text-gray-600"
                [ngClass]="{
    'bg-[#A4FF9A] border-green-600':
      ['confirmada', 'match'].includes((formatEstado(item[col.key]) || '').toLowerCase()),

    'bg-[#FFF48E] border-yellow-600':
      (formatEstado(item[col.key]) || '').toLowerCase() === 'despachada',

    'bg-[#FF9752] border-orange-600':
      (formatEstado(item[col.key]) || '').toLowerCase() === 'no match',

    'bg-gray-200 border-gray-500':
      !['confirmada', 'despachada', 'match', 'no match'].includes(
        (formatEstado(item[col.key]) || '').toLowerCase()
      )
  }">
                {{ formatEstado(item[col.key]) }}
              </span>

            </span>
            <span *ngSwitchDefault>{{ item[col.key] }}</span>
          </ng-container>
        </td>

        <td *ngIf="showActions" class="px-4 py-3 text-center">
          <button class="text-gray-500 hover:text-[#1751cf] transition" (click)="onView(item)">
            <i class="fa-regular fa-eye text-lg"></i>
          </button>
        </td>
      </tr>
    </tbody>
  </table>
</div>